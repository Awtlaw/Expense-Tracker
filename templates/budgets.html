{% extends "layout.html" %} {% block title %}Budget Management{% endblock %} {%
block content %}

<div class="container my-5">
  <div class="row align-items-center mb-4">
    <div class="col">
      <h1><i class="fas fa-bullseye"></i> Budget Management</h1>
      <p class="text-muted">Manage your per-category spending budgets</p>
    </div>
    <div class="col-auto">
      <a href="{{ url_for('main.profile') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Add Budget
      </a>
    </div>
  </div>

  <!-- Alerts -->
  {% with messages = get_flashed_messages() %} {% if messages %} {% for message
  in messages %}
  <div class="alert alert-info alert-dismissible fade show" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %} {% endif %} {% endwith %}

  <!-- Budget Cards -->
  {% if budget_data %}
  <div class="row">
    {% for budget in budget_data %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h5 class="card-title mb-1">{{ budget.category }}</h5>
              <small class="text-muted">Monthly Budget</small>
            </div>
            <form
              method="POST"
              action="{{ url_for('main.delete_budget', budget_id=budget.id) }}"
              style="display: inline"
              onsubmit="
                return confirm('Are you sure you want to delete this budget?');
              "
            >
              <button type="submit" class="btn btn-sm btn-outline-danger">
                <i class="fas fa-trash"></i>
              </button>
            </form>
          </div>

          <!-- Budget Amount -->
          <div class="mb-3">
            <h3 class="text-primary">${{ "%.2f"|format(budget.limit) }}</h3>
            <p class="mb-0">
              <strong>Spent:</strong> ${{ "%.2f"|format(budget.spent) }}
            </p>
            {% if budget.is_exceeded %}
            <p class="text-danger mb-0">
              <strong>Over by:</strong> ${{ "%.2f"|format(budget.spent -
              budget.limit) }}
            </p>
            {% else %}
            <p class="text-success mb-0">
              <strong>Remaining:</strong> ${{ "%.2f"|format(budget.remaining) }}
            </p>
            {% endif %}
          </div>

          <!-- Progress Bar -->
          <div class="progress" style="height: 12px">
            <div
              class="progress-bar {% if budget.is_exceeded %}bg-danger{% elif budget.percentage > 75 %}bg-warning{% else %}bg-success{% endif %}"
              role="progressbar"
              style="width: {{ [budget.percentage, 100]|min }}%"
              aria-valuenow="{{ budget.percentage }}"
              aria-valuemin="0"
              aria-valuemax="100"
            ></div>
          </div>

          <!-- Percentage -->
          <small class="text-muted mt-2 d-block">
            {{ "%.1f"|format(budget.percentage) }}% of budget used
          </small>

          <!-- Status Badge -->
          <div class="mt-3">
            {% if budget.is_exceeded %}
            <span class="badge bg-danger">
              <i class="fas fa-exclamation-circle"></i> Over Budget
            </span>
            {% elif budget.percentage > 75 %}
            <span class="badge bg-warning">
              <i class="fas fa-exclamation-triangle"></i> Approaching Limit
            </span>
            {% else %}
            <span class="badge bg-success">
              <i class="fas fa-check-circle"></i> On Track
            </span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info text-center py-5">
    <h5><i class="fas fa-info-circle"></i> No Budgets Set</h5>
    <p class="mb-3">You haven't set any per-category budgets yet.</p>
    <a href="{{ url_for('main.profile') }}" class="btn btn-primary">
      <i class="fas fa-plus"></i> Create Your First Budget
    </a>
  </div>
  {% endif %}
</div>

<style>
  .card {
    transition:
      transform 0.2s,
      box-shadow 0.2s;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
  }

  .progress {
    background-color: #e9ecef;
  }
</style>

{% endblock %}
