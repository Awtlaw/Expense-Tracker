{% extends "layout.html" %} {% block title %}Profile{% endblock %} {% block
content %}
<div class="container mt-5">
  <!-- Profile Header -->
  <div class="card shadow-sm mb-4">
    <div class="card-body text-center">
      <div class="mb-3">
        <img
          src="https://ui-avatars.com/api/?name={{ user.username }}&size=120&background=0d6efd&color=fff"
          class="rounded-circle"
          alt="Profile Avatar"
        />
      </div>
      <h4 class="mb-0">{{ user.username }}</h4>
      <p class="text-muted">{{ user.email }}</p>
      <small class="text-muted">
        Member since {{ user.created_at[:10] }}
      </small>
    </div>
  </div>

  <!-- Account Summary -->
  <div class="row text-center mb-4">
    <div class="col-md-4 mb-3">
      <div class="card bg-success text-white shadow-sm">
        <div class="card-body">
          <h6>Total Income</h6>
          <h4>{{ total_income | usd }}</h4>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div class="card bg-danger text-white shadow-sm">
        <div class="card-body">
          <h6>Total Expenses</h6>
          <h4>{{ total_expenses | usd }}</h4>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-3">
      <div class="card bg-primary text-white shadow-sm">
        <div class="card-body">
          <h6>Current Balance</h6>
          <h4>{{ balance | usd }}</h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Total Monthly Budget Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <strong><i class="fas fa-calculator"></i> Total Monthly Budget</strong>
    </div>
    <div class="card-body">
      <p class="text-muted mb-3">
        Set a maximum amount you want to spend this month across all categories:
      </p>
      <form method="POST" action="{{ url_for('main.set_total_budget') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="row align-items-end">
          <div class="col-md-6 mb-3">
            <label class="form-label">Monthly Spending Limit ($)</label>
            <input
              type="number"
              step="0.01"
              min="0"
              name="total_budget"
              class="form-control form-control-lg"
              placeholder="e.g., 2000.00"
              value="{{ total_monthly_budget or '' }}"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <button type="submit" class="btn btn-success btn-lg w-100">
              <i class="fas fa-save"></i> Set Total Budget
            </button>
          </div>
        </div>
        {% if total_monthly_budget %}
        <div class="alert alert-info mt-3">
          <small
            >Current total monthly budget:
            <strong>${{ "%.2f"|format(total_monthly_budget) }}</strong></small
          >
        </div>
        {% endif %}
      </form>
    </div>
  </div>

  <!-- Smart Budget Setup Section -->
  {% if budget_suggestions %}
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <strong
        ><i class="fas fa-magic"></i> Smart Budget Setup (by Category)</strong
      >
    </div>
    <div class="card-body">
      <p class="text-muted mb-3">
        Based on your spending over the last 3 months, we suggest these category
        budgets:
      </p>
      <form method="POST" action="{{ url_for('main.set_budgets_bulk') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Category</th>
                <th>Avg Spent</th>
                <th>Suggested Budget</th>
                <th>Your Budget</th>
              </tr>
            </thead>
            <tbody>
              {% for suggestion in budget_suggestions %}
              <tr>
                <td>
                  <strong>{{ suggestion.category }}</strong>
                </td>
                <td>
                  <span class="badge bg-secondary"
                    >${{ "%.2f"|format(suggestion.avg_spent) }}</span
                  >
                </td>
                <td>
                  <span class="text-success"
                    ><strong
                      >${{ "%.2f"|format(suggestion.suggested) }}</strong
                    ></span
                  >
                </td>
                <td>
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    name="budget_{{ suggestion.category }}"
                    class="form-control form-control-sm"
                    value="{{ suggestion.suggested }}"
                    style="max-width: 120px"
                  />
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="alert alert-info mb-3">
          <small
            ><i class="fas fa-info-circle"></i> Suggested budgets are 15% above
            your average spending. Feel free to adjust!</small
          >
        </div>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-check"></i> Apply Category Budgets
        </button>
      </form>
    </div>
  </div>
  {% endif %}

  <!-- Budget Settings Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-header">
      <strong><i class="fas fa-wallet"></i> Manual Budget Settings</strong>
    </div>
    <div class="card-body">
      <p class="text-muted mb-3">Or set budgets manually by category:</p>
      <form method="POST" action="{{ url_for('main.set_budget') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Category</label>
            <select name="category" class="form-control" required>
              <option value="">Select a category...</option>
              <option value="Food">Food</option>
              <option value="Transport">Transport</option>
              <option value="Utilities">Utilities</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Healthcare">Healthcare</option>
              <option value="Shopping">Shopping</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Monthly Budget Limit ($)</label>
            <input
              type="number"
              step="0.01"
              min="0"
              name="budget_limit"
              class="form-control"
              placeholder="e.g., 500.00"
              required
            />
          </div>
        </div>
        <button class="btn btn-primary">Set Budget</button>
      </form>
    </div>
  </div>

  <!-- Account Settings Section -->
  <div class="card shadow-sm">
    <div class="card-header">
      <strong>Account Settings</strong>
    </div>
    <div class="card-body">
      <form method="POST" action="{{ url_for('main.change_password') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="mb-3">
          <label class="form-label">Current Password</label>
          <input
            type="password"
            name="current_password"
            class="form-control"
            required
          />
        </div>

        <div class="mb-3">
          <label class="form-label">New Password</label>
          <input
            type="password"
            name="new_password"
            class="form-control"
            required
          />
        </div>

        <div class="mb-3">
          <label class="form-label">Confirm New Password</label>
          <input
            type="password"
            name="confirmation"
            class="form-control"
            required
          />
        </div>

        <button class="btn btn-primary">Change Password</button>

        <div class="mb-4 text-end">
          <a
            href="{{ url_for('main.export_pdf') }}"
            class="btn btn-outline-secondary"
          >
            Export PDF
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
